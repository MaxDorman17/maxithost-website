<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Start hosting with MaxIThost. Fill in your details and we'll onboard your site manually. We aim to have most sites live within 1 business day.">
    <title>Start hosting with MaxIThost</title>
    <link rel="stylesheet" href="/css/style.css?v=20260123">
    <style>
        /* Onboarding page layout */
        .onboarding-layout {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 3rem;
            align-items: start;
        }

        .onboarding-form-col {
            background-color: var(--white);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-200);
        }

        .onboarding-help-col {
            position: sticky;
            top: 100px;
        }

        .help-panel {
            background-color: var(--gray-50);
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 1px solid var(--gray-200);
        }

        /* Collapsible sections */
        .collapsible {
            border-bottom: 1px solid var(--gray-200);
        }

        .collapsible:last-child {
            border-bottom: none;
        }

        .collapsible-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 1rem 0;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--navy);
            text-align: left;
        }

        .collapsible-toggle:hover {
            color: var(--blue);
        }

        .collapsible-icon {
            transition: transform 0.2s;
            color: var(--gray-400);
        }

        .collapsible-toggle[aria-expanded="true"] .collapsible-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            display: none;
            padding-bottom: 1rem;
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .collapsible-content.open {
            display: block;
        }

        .collapsible-content p {
            margin-bottom: 0.75rem;
        }

        .collapsible-content ul {
            margin-bottom: 0.75rem;
            padding-left: 1.25rem;
        }

        .collapsible-content li {
            margin-bottom: 0.25rem;
        }

        /* Mobile: stack vertically */
        @media (max-width: 900px) {
            .onboarding-layout {
                grid-template-columns: 1fr;
            }

            .onboarding-help-col {
                position: static;
                order: 2;
            }

            .onboarding-form-col {
                order: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <a href="index.html" class="logo">
                <img src="images/logo.png" alt="MaxIThost">
                MaxIThost
            </a>
            <button class="nav-toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav class="nav">
                <a href="index.html">Home</a>
                <a href="hosting.html">Hosting</a>
                <a href="pricing.html">Pricing</a>
                <a href="about.html">About</a>
                <a href="contact.html">Contact</a>
                <a href="start-hosting.html" class="btn btn--primary nav-cta">Get started</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Start hosting with MaxIThost</h1>
            <p>Fill in the details below so we can onboard your site smoothly.<br>
            Payment happens after you submit this form.<br>
            We aim to have most sites live within 1 business day.</p>
        </div>
    </section>

    <!-- Trust Summary -->
    <section class="section" style="padding: 2rem 0; background-color: var(--gray-50); border-bottom: 1px solid var(--gray-200);">
        <div class="container">
            <div style="display: flex; flex-wrap: wrap; gap: 3rem; justify-content: center; text-align: center;">
                <div>
                    <h4 style="margin-bottom: 0.75rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--gray-500);">How onboarding works</h4>
                    <p style="margin: 0; font-size: 0.9rem; color: var(--gray-700);">Submit your details &rarr; Complete secure checkout &rarr; We onboard your site &rarr; We confirm when it's live</p>
                </div>
                <div>
                    <h4 style="margin-bottom: 0.75rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--gray-500);">You'll need</h4>
                    <p style="margin: 0; font-size: 0.9rem; color: var(--gray-700);">A domain or subdomain &bull; A GitHub repository or a ZIP/download link</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content: Form + Instructions -->
    <section class="section">
        <div class="container">
            <div class="onboarding-layout">
                <!-- Left Column: Form -->
                <div class="onboarding-form-col">
                    <!-- Important Note -->
                    <div style="background-color: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1.25rem; margin-bottom: 1.5rem;">
                        <p style="margin: 0; font-size: 0.9rem;"><strong>Important:</strong> This page is for new hosting customers.<br>
                        If you have questions before signing up, please use the <a href="contact.html">contact page</a>.</p>
                    </div>

                    <h2 class="mb-3">Start your onboarding</h2>

                    <!-- Success Message (hidden by default) -->
                    <div id="form-success" style="display: none;">
                        <h3 style="color: var(--navy); margin-bottom: 1rem;">Request received</h3>
                        <p>Thanks — we've received your onboarding details.</p>

                        <!-- Payment Section -->
                        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--gray-200);">
                            <h4 style="color: var(--navy); margin-bottom: 0.5rem;">Next step: payment</h4>
                            <p style="margin-bottom: 1.5rem;">
                                Click below to continue to secure checkout. Once payment succeeds, onboarding + deployment will start automatically.
                            </p>

                            <div id="payment-single">
                                <a id="payment-btn" href="#" class="btn btn--primary btn--large">Continue to secure checkout</a>
                                <p id="payment-status" style="margin-top: 0.75rem; font-size: 0.9rem; color: var(--gray-600); display:none;"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Onboarding Form -->
                    <form id="onboarding-form" action="https://n8n.maxithost.co.uk/webhook/onboarding-intake" method="POST" class="contact-form">
                        <!-- Hidden fields -->
                        <input type="text" name="_gotcha" style="display: none;" tabindex="-1" autocomplete="off">
                        <input type="hidden" name="_subject" value="New Hosting Onboarding — MaxIThost">
                        <input type="hidden" name="source_page" value="/start-hosting">

                        <!-- Error message -->
                        <div id="form-error" style="display: none; color: #dc2626; background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;"></div>

                        <!-- Required fields -->
                        <div class="form-group">
                            <label for="full_name">Full name <span class="required">*</span></label>
                            <input type="text" id="full_name" name="full_name" required>
                        </div>

                        <div class="form-group">
                            <label for="email">Email address <span class="required">*</span></label>
                            <input type="email" id="email" name="email" required>
                        </div>

                        <div class="form-group">
                            <label for="plan">Hosting plan <span class="required">*</span></label>
                            <select id="plan" name="plan" required>
                                <option value="">Please select...</option>
                                <option value="Starter">Starter</option>
                                <option value="Professional">Professional</option>
                                <option value="Multi-Site">Multi-Site</option>
                                <option value="Test">Test</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="domain">Domain or subdomain request <span class="required">*</span></label>
                            <input type="text" id="domain" name="domain" required placeholder="e.g. example.com or mysite.MaxIThost.co.uk">
                        </div>

                        <div class="form-group">
                            <label for="delivery_method">Delivery method <span class="required">*</span></label>
                            <select id="delivery_method" name="delivery_method" required>
                                <option value="">Please select...</option>
                                <option value="github">GitHub</option>
                                <option value="zip">ZIP/Download link</option>
                                <option value="migration">Migration</option>
                            </select>
                        </div>

                        <!-- Optional fields -->
                        <div class="form-group">
                            <label for="repo_or_download_url_github">GitHub repository URL</label>
                            <!-- IMPORTANT: keep name repo_or_download_url for GitHub -->
                            <input type="url" id="repo_or_download_url_github" name="repo_or_download_url" placeholder="https://github.com/username/repo.git">
                        </div>

                        <div class="form-group">
                            <label for="github_branch">GitHub branch</label>
                            <input type="text" id="github_branch" name="github_branch" value="main" placeholder="main">
                        </div>

                        <div class="form-group">
                            <label for="repo_or_download_url_zip">Download link</label>
                            <!-- IMPORTANT: give ZIP field a DIFFERENT name so it doesn't overwrite GitHub -->
                            <input type="url" id="repo_or_download_url_zip" name="repo_or_download_url_zip" placeholder="https://...">
                        </div>

                        <div class="form-group">
                            <label for="notes">Notes / special requirements <span class="required">*</span></label>
                            <textarea id="notes" name="notes" rows="4" required placeholder="Any specific requirements, build commands, or notes for setup"></textarea>
                        </div>

                        <div class="form-group">
                            <label style="display: flex; align-items: flex-start; gap: 0.5rem; font-weight: normal; cursor: pointer;">
                                <input type="checkbox" id="terms_accepted" name="terms_accepted" value="yes" required style="margin-top: 0.25rem;">
                                <span>I agree to the <a href="terms.html" target="_blank" rel="noopener">Terms of Service</a> and <a href="privacy.html" target="_blank" rel="noopener">Privacy Policy</a>.</span>
                            </label>
                        </div>

                        <div class="form-group">
                            <button type="submit" class="btn btn--primary btn--large">Submit onboarding request</button>
                        </div>
                    </form>
                </div>

                <!-- Right Column: Instructions -->
                <div class="onboarding-help-col">
                    <div class="help-panel">
                        <h4 style="margin-bottom: 1rem; color: var(--gray-500); font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; letter-spacing: 0.05em;">Need help?</h4>

                        <!-- Collapsible: Before you start -->
                        <div class="collapsible">
                            <button class="collapsible-toggle" type="button" aria-expanded="false">
                                <span>Before you start</span>
                                <svg class="collapsible-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <div class="collapsible-content">
                                <p>To help us onboard your site smoothly, please have one of the following ready:</p>
                                <p><strong>GitHub (recommended)</strong><br>
                                A link to your repository, with the production branch (usually <code>main</code>).</p>
                                <p><strong>ZIP file or download link</strong><br>
                                A ZIP of your website files, or a link via Google Drive, Dropbox, or similar.</p>
                                <p><strong>Not sure which to choose?</strong><br>
                                That's fine — just tell us in the notes and we'll help.</p>
                            </div>
                        </div>

                        <!-- Collapsible: How to provide a download link -->
                        <div class="collapsible">
                            <button class="collapsible-toggle" type="button" aria-expanded="false">
                                <span>How to provide a download link</span>
                                <svg class="collapsible-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <div class="collapsible-content">
                                <p><strong>Providing your website via download link</strong></p>
                                <p>If you're not using GitHub, you can send your website as a ZIP file using a download link.</p>
                                <p><strong>Step 1:</strong><br>
                                Zip your website files into a single .zip file.</p>
                                <p><strong>Step 2:</strong><br>
                                Upload the ZIP to one of the following:</p>
                                <ul>
                                    <li>Google Drive</li>
                                    <li>Dropbox</li>
                                    <li>OneDrive</li>
                                    <li>WeTransfer</li>
                                </ul>
                                <p><strong>Step 3:</strong><br>
                                Make sure the link is set to "Anyone with the link can view/download".</p>
                                <p><strong>Step 4:</strong><br>
                                Paste the link into the Download link field on the form, or email it to <a href="mailto:onboarding@MaxIThost.co.uk">onboarding@MaxIThost.co.uk</a>.</p>
                                <p>That's it — we'll take it from there.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <a href="index.html" class="logo">
                        <img src="images/logo.png" alt="MaxIThost">
                        MaxIThost
                    </a>
                    <p>Managed hosting for businesses that want it done properly.</p>
                </div>
                <div class="footer-links">
                    <div>
                        <h4>Pages</h4>
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li><a href="hosting.html">Hosting</a></li>
                            <li><a href="pricing.html">Pricing</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4>Company</h4>
                        <ul>
                            <li><a href="about.html">About</a></li>
                            <li><a href="contact.html">Contact</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4>Legal</h4>
                        <ul>
                            <li><a href="terms.html">Terms</a></li>
                            <li><a href="privacy.html">Privacy</a></li>
                            <li><a href="cookies.html">Cookies</a></li>
                            <li><a href="billing.html">Billing</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 MaxIThost. All rights reserved. Scotland-based managed hosting for small businesses.</p>
            </div>
        </div>
    </footer>

    <script>
        // Mobile navigation toggle
        document.querySelector('.nav-toggle').addEventListener('click', function() {
            document.querySelector('.nav').classList.toggle('active');
        });

        // Collapsible sections
        document.querySelectorAll('.collapsible-toggle').forEach(function(toggle) {
            toggle.addEventListener('click', function() {
                var expanded = this.getAttribute('aria-expanded') === 'true';
                var content = this.nextElementSibling;

                this.setAttribute('aria-expanded', !expanded);
                content.classList.toggle('open');
            });
        });

        // Onboarding form submission + Create Checkout
        (function() {
            var form = document.getElementById('onboarding-form');
            var errorBox = document.getElementById('form-error');
            var successBox = document.getElementById('form-success');
            var paymentBtn = document.getElementById('payment-btn');
            var paymentStatus = document.getElementById('payment-status');

            // Helper: show errors
            function showError(msg) {
                errorBox.innerHTML = msg;
                errorBox.style.display = 'block';
            }

            // Helper: normalize plan to what n8n expects (you can adjust later)
            function normalizePlan(planValue) {
                // Keep your values as-is for now. If n8n expects lowercase, change it later.
                return (planValue || '').trim();
            }

            // Helper: choose repo_or_download_url based on delivery method
            function pickRepoOrDownloadURL() {
                var delivery = (document.getElementById('delivery_method').value || '').trim().toLowerCase();
                var githubUrl = (document.getElementById('repo_or_download_url_github').value || '').trim();
                var zipUrl = (document.getElementById('repo_or_download_url_zip').value || '').trim();

                if (delivery === 'github') return githubUrl;
                if (delivery === 'zip') return zipUrl;
                return ''; // migration or other
            }

            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();

                    // Hide any previous error
                    errorBox.style.display = 'none';
                    errorBox.textContent = '';

                    // Disable submit button during request
                    var submitBtn = form.querySelector('button[type="submit"]');
                    var originalText = submitBtn.textContent;
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Submitting...';

                    // Build the form data we send to onboarding-intake
                    var fd = new FormData(form);

                    // IMPORTANT: ensure repo_or_download_url is a SINGLE value based on delivery_method
                    // (prevents github/zip overwriting each other)
                    fd.set('repo_or_download_url', pickRepoOrDownloadURL());

                    fetch(form.action, {
                        method: 'POST',
                        body: fd,
                        headers: { 'Accept': 'application/json' }
                    })
                    .then(function(response) {
                        if (!response.ok) throw new Error('Submission failed');
                        return response.json(); // MUST return JSON with intake_id/client_id/etc
                    })
                    .then(function(intakeResp) {
                        // intakeResp should include at least intake_id + client_id
                        if (!intakeResp || !intakeResp.intake_id || !intakeResp.client_id) {
                            throw new Error('onboarding-intake did not return intake_id/client_id');
                        }

                        // Show success UI
                        form.style.display = 'none';
                        successBox.style.display = 'block';
                        successBox.scrollIntoView({ behavior: 'smooth', block: 'center' });

                        // Wire up payment button to call create-checkout and redirect to checkout_url
                        paymentBtn.onclick = function(ev) {
                            ev.preventDefault();

                            paymentBtn.classList.add('disabled');
                            paymentBtn.textContent = 'Creating secure checkout...';
                            paymentBtn.setAttribute('aria-disabled', 'true');
                            if (paymentStatus) {
                                paymentStatus.style.display = 'block';
                                paymentStatus.textContent = 'Please wait...';
                            }

                            var payload = {
                                intake_id: intakeResp.intake_id,
                                client_id: intakeResp.client_id,
                                client_slug: intakeResp.client_slug || '',
                                plan: normalizePlan(intakeResp.plan || document.getElementById('plan').value),
                                delivery_method: (document.getElementById('delivery_method').value || '').trim().toLowerCase(),
                                domain: (document.getElementById('domain').value || '').trim(),
                                repo_or_download_url: pickRepoOrDownloadURL(),
                                github_branch: (document.getElementById('github_branch').value || 'main').trim()
                            };

                            fetch('https://n8n.maxithost.co.uk/webhook/create-checkout', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            })
                            .then(function(r) {
                                if (!r.ok) throw new Error('create-checkout failed');
                                return r.json();
                            })
                            .then(function(data) {
                                if (!data || !data.checkout_url) throw new Error('Missing checkout_url');
                                window.location.href = data.checkout_url;
                            })
                            .catch(function(err) {
                                if (paymentStatus) {
                                    paymentStatus.style.display = 'block';
                                    paymentStatus.textContent = 'Could not create checkout. Please refresh and try again.';
                                }
                                paymentBtn.classList.remove('disabled');
                                paymentBtn.textContent = 'Continue to secure checkout';
                                paymentBtn.removeAttribute('aria-disabled');
                                console.error(err);
                            });
                        };

                        // Reset button text for the now-visible state
                        paymentBtn.textContent = 'Continue to secure checkout';
                    })
                    .catch(function(error) {
                        showError('Something went wrong — please try again or email <a href="mailto:onboarding@MaxIThost.co.uk">onboarding@MaxIThost.co.uk</a>.');
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                        console.error(error);
                    });
                });
            }
        })();
    </script>
</body>
</html>
